{% extends "base.html" %}

{% block content %}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}">
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'timeGridWeek',
            headerToolbar: {
                left: 'prev,next',
                center: 'title',
                right: 'timeGridWeek,timeGridDay,dayGridMonth',
            },
            contentHeight: 'auto',
            events: '/send-appointments',
            eventTimeFormat: {
                hour: '2-digit',
                minute: '2-digit',
                meridiem: false
            },
        });

        calendar.render();
    });
</script>

<div class="container">
    <div id='calendar'></div>
    <h1>Vet Appointments</h1>

    <div class="button-menu-container">
        <button id="add-appointment-toggle" onclick="toggleAddAppointmentForm()">âž•</button>
        <button id="add-lookup-toggle" onclick="toggleLookupAppointment()">ðŸ”Ž</button>
    </div>

    <form id="add-appointment-form" class="add-appointment-form" action="{{ url_for('add_appointment_route') }}" method="POST">
        <input type="date" name="date" required>
        <input type="time" name="time" required>
        <input type="text" name="doctor" placeholder="doctor" required>
        <input type="text" name="room" placeholder="room" required>
        <input type="text" name="animal" placeholder="animal" required>
        <input type="submit" value="Add Appointment">
    </form>

    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Time</th>
                <th>Room</th>
                <th>Doctor</th>
                <th>Animal's name</th>
            </tr>
        </thead>
        <tbody>
            {% for appointment in appointments %}
            <tr>
                <td>{{ appointment.date.strftime('%Y-%m-%d') }}</td>
                <td>{{ appointment.time.strftime('%H:%M') }}</td>
                <td>{{ appointment.room }}</td>
                <td>{{ appointment.doctor }}</td>
                <td>{{ appointment.animal }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% with messages = get_flashed_messages() %}
    {% if messages %}
    <div class="flash-messages">
        {% for message in messages %}
        <div class="flash-message">{{ message }}</div>
        {% endfor %}
    </div>
    {% endif %}
    {% endwith %}
</div>

<script>
    function toggleAddAppointmentForm() {
        var form = document.getElementById("add-appointment-form");
        form.classList.toggle("show");
    }
</script>

<script>
    function toggleLookupAppointment() {
        var form = document.getElementById("add-appointment-form");
        form.classList.toggle("show");
    }
</script>
{% endblock %}
